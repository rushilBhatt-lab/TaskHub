name: CI

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - name: Use Node.js 21
        uses: actions/setup-node@v2
        with:
          node-version: '21'

      - name: Cache node modules
        uses: actions/cache@v1
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-
      - name: Install packages
        run: npm ci --legacy-peer-deps
      - name: Check code formatting
        run: npm run prettier:check
      - name: Run linter
        run: npm run lint:ci
      - name: Set environment variable for routes
        run: |
        if [[ $GITHUB_REF == refs/heads/main ]]; then
          echo "REACT_APP_SHOW_EXTRA_ROUTES=false" >> $GITHUB_ENV
        else
          echo "REACT_APP_SHOW_EXTRA_ROUTES=true" >> $GITHUB_ENV
        fi
